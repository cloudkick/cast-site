

<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
	"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

	<head>

		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<title>
			
			Cast Project : developer-information : Tests
			
		</title>

		

		<link href="/blog/atom.xml" rel="alternate" title="Cast Project" type="application/atom+xml"/>

		

		

		<link rel="stylesheet" href="/media/css/reset.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="/media/css/base.css" type="text/css" media="screen" charset="utf-8">
		<link rel="stylesheet" href="/media/css/syntax.css" type="text/css" media="screen" charset="utf-8">

		
		
		
		
		
		

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>

		
		
		
		

	</head>

	<body>

		<div id="site">	

			<div id="header">
  <a href="/index.html">
    <h1><img src="/media/images/cast_logo.png" id="site-logo" /> Cast Project</h1>
  </a>
</div>








<div id="sitenav">
    <ul>
        <li>
            <a href="/">Home</a>
        </li>

        <li>
            <a href="/start/">Get Started</a>
        </li>

        <li>
            <a href="/docs/">Documentation</a>
        </li>

        <li class="selected" >
            <a href="/developer-information/">Developers</a>
        </li>

        <li>
            <a href="/about/">About</a>
        </li>

        <li>
            <a href="/sitemap/">Sitemap</a>
        </li>
    </ul>
</div>







<ul class="breadcrumbs">
	
		<li>
			<a href="/">Cast Project</a>

			
				
				<span class="separator">&raquo;</span>
				
			
		</li>
	
		<li>
			<a href="/developer-information/">Developer Information</a>

			
				
				<span class="separator">&raquo;</span>
				
			
		</li>
	
		<li>
			<a href="/developer-information/tests/">Tests</a>

			
		</li>
	
</ul>
    




			


<div id="content-header"><h2>Tests</h2></div>



  <p>For the Cast tests we use a custom written test runner which runs every test file in
a separate process.<br /><br /></p>
<p>Tests are logically grouped in a file and each test is wrapped inside an anonymous
function (similar to the Node tests).<br /><br /></p>
<p>Because tests are wrapped inside anonymous function you are encouraged to write
a short comment about what the test does above this function.<br /><br /></p>
<p>Here is an example test taken from the hooks test file (<code>test/simple/hooks.js</code>):</p>
<div class="code"><div class="highlight"><pre><span class="c1">// Test success (exit code == 0)</span><br /><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><br />  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><br />&nbsp;<br />  <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">killed</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span><br />    <span class="nx">assert</span><span class="p">.</span><span class="nx">ifError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span><br />    <span class="nx">assert</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="o">!</span><span class="nx">killed</span><span class="p">);</span><br />&nbsp;<br />    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s1">&#39;test hook success stdout&#39;</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">);</span><br />    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s1">&#39;test hook success stderr&#39;</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">);</span><br />&nbsp;<br />    <span class="nx">n</span><span class="o">++</span><span class="p">;</span><br />  <span class="p">};</span><br />&nbsp;<br />  <span class="kd">var</span> <span class="nx">hook_file</span> <span class="o">=</span> <span class="s1">&#39;hook_success.js&#39;</span><span class="p">;</span><br />  <span class="kd">var</span> <span class="nx">base_hook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">hooks</span><span class="p">.</span><span class="nx">Hook</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="nx">hook_file</span><span class="p">,</span><br />                                  <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">hooks_path</span><span class="p">,</span> <span class="nx">hook_file</span><span class="p">),</span><br />                                  <span class="kc">false</span><span class="p">);</span><br />  <span class="kd">var</span> <span class="nx">instance_hook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">hooks</span><span class="p">.</span><span class="nx">InstanceHook</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="nx">hook_file</span><span class="p">,</span><br />                                             <span class="nx">instance_version_path</span><span class="p">);</span><br />  <span class="nx">base_hook</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[],</span> <span class="nx">callback</span><span class="p">);</span><br />  <span class="nx">instance_hook</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[],</span> <span class="nx">callback</span><span class="p">);</span><br />&nbsp;<br />  <span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><br />    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Tests completed&#39;</span><span class="p">);</span><br />  <span class="p">});</span><br /><span class="p">})();</span><br /></pre></div><br /></div>

<p>To run all the tests, issue the following command in the Cast root folder:<br /><br /></p>
<div class="code"><div class="highlight"><pre><span class="go">scons test</span><br /></pre></div><br /></div>

<p>If all the tests pass, you should see an output similar to the one bellow:<br /><br /></p>
<div class="code"><div class="highlight"><pre><span class="gp">vagrant@vagrantup:/data/cast$</span> scons <span class="nb">test</span><br /><span class="go">scons: Reading SConscript files ...</span><br /><span class="go">scons: done reading SConscript files.</span><br /><span class="go">scons: Building targets ...</span><br /><span class="go">/usr/local/bin/node tests/run.js --verbosity 2 --tests &#39;tests/integration/test-basic-client.js tests/simple/ck-agent-service.js tests/simple/command-parser.js&#39;</span><br /><span class="go">Running test: test-basic-client.js</span><br /><span class="go">Running test: ck-agent-service.js</span><br /><span class="go">Running test: command-parser.js</span><br /><span class="go">==================== Tests Complete ====================</span><br /><span class="go">    Successes: 19</span><br /><span class="go">     - integration/test-basic-client.js</span><br /><span class="go">     - simple/ck-agent-service.js</span><br /><span class="go">     - simple/command-parser.js</span><br /><span class="go">     Failures: 0</span><br /><span class="go">    ------------------</span><br /><span class="go">        Total: 19</span><br /><span class="go">scons: done building targets.</span><br /></pre></div><br /></div>

<p>If you don't want to run all the tests, you can pass a comma separated list of
relative paths to the tests files to scons test target: <br /><br /></p>
<div class="code"><div class="highlight"><pre><span class="go">scons test tests=&quot;tests/simple/util-version.js tests/simple/util-templates.js&quot;</span><br /></pre></div><br /></div>

<p>This will run all the tests in file <code>tests/simple/util-version.js</code> and
<code>tests/simple/util-templates.js</code>.</p>




			<div id='footer'>Copyright Cast Project</div>


		</div>

	</body>

</html>

